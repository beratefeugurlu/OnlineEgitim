@{
    ViewData["Title"] = "Ödeme";
}

<div class="container mt-5">
    <h2 class="mb-4">💳 Ödeme Sayfası</h2>

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    <form id="paymentForm" class="card p-4 shadow-sm">
        <div class="mb-3">
            <label class="form-label">Kart Numarası</label>
            <input type="text" name="cardNumber" class="form-control" required />
        </div>
        <div class="mb-3">
            <label class="form-label">Son Kullanma Tarihi</label>
            <input type="text" name="expiryDate" placeholder="AA/YY" class="form-control" required />
        </div>
        <div class="mb-3">
            <label class="form-label">CVV</label>
            <input type="text" name="cvv" class="form-control" required />
        </div>

        <button type="submit" class="btn btn-success w-100">Ödeme Yap</button>
    </form>

    <div id="paymentResult" class="mt-3"></div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#paymentForm").submit(function (e) {
                e.preventDefault();

                var paymentData = {
                    cardNumber: $("input[name='cardNumber']").val(),
                    expiryDate: $("input[name='expiryDate']").val(),
                    cvv: $("input[name='cvv']").val()
                };

                $.ajax({
                    url: "/Payment/Pay",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(paymentData),
                    success: function (response) {
                        $("#paymentResult").html('<div class="alert alert-success">✅ Ödeme başarılı!</div>');
                        // ödeme sonrası yönlendirme için
                        // window.location.href = "/Course";
                    },
                    error: function () {
                        $("#paymentResult").html('<div class="alert alert-danger">❌ Ödeme başarısız. Tekrar deneyin.</div>');
                    }
                });
            });
        });
    </script>
}
